---
layout: default
title: Exoplanets
permalink: /exoplanets
---

<div id="exo-explorer" class="exo-container">
  <div class="exo-controls">
    <div class="exo-card">
      <h2>Axes</h2>
      <div class="exo-grid2">
        <label>X axis
          <select id="xSelect" class="exo-input"></select>
        </label>
        <label>Y axis
          <select id="ySelect" class="exo-input"></select>
        </label>
        <label class="exo-check"><input id="xLog" type="checkbox"/> Log X</label>
        <label class="exo-check"><input id="yLog" type="checkbox"/> Log Y</label>
      </div>
    </div>
    <div class="exo-card">
      <h2>Highlighting</h2>
      <label class="exo-check"><input id="highlightJWSTObserved" type="checkbox" checked/> JWST – Observed</label>
      <label class="exo-check"><input id="highlightJWSTPlanned" type="checkbox" checked/> JWST – Planned</label>
      <label class="exo-check"><input id="onlyTransiting" type="checkbox"/> Only transiting</label>
    </div>
    <div class="exo-card">
      <h2>Search / Data</h2>
      <input id="searchBox" placeholder="Search planet or host star…" class="exo-input"/>
      <button id="downloadCSV" class="exo-btn">Download filtered CSV</button>
    </div>
  </div>

  <div class="exo-main">
    <div id="plot" class="exo-plot"></div>
    <aside class="exo-card">
      <h3>Legend</h3>
      <ul class="exo-legend">
        <li><span class="dot pop"></span> Population</li>
        <li><span class="dot jwstObs"></span> JWST – Observed</li>
        <li><span class="dot jwstPlan"></span> JWST – Planned</li>
      </ul>
      <div id="counts" class="exo-note">—</div>
      <hr/>
      <div class="exo-note">
        Data files: <code>/assets/data/pscomppars_recent.csv</code>, <code>/assets/data/jwst_trexolists_extended.csv</code>
      </div>
    </aside>
  </div>

  <details class="exo-card">
    <summary>Show data file paths</summary>
    <pre id="endpoints" class="exo-code"></pre>
  </details>

  <div id="status" class="exo-note">Loading CSV files…</div>
</div>

<!-- libs -->
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
:root {
  --mpurple: #9370DB;
  --mpurple-600: #7a5fd5;
  --muted: #6b7280;
  --card: #ffffff;
  --bg: #f6f4fb;
}
.exo-container { display: grid; gap: 1rem; }
.exo-controls { display: grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap: 1rem; }
.exo-main { display: grid; grid-template-columns: 1fr 280px; gap: 1rem; }
.exo-card { background: var(--card); border: 1px solid #e5e7eb; border-radius: 16px; padding: 1rem; box-shadow: 0 1px 2px rgba(0,0,0,.05); }
.exo-plot { height: 68vh; background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; }
.exo-input { width: 100%; padding: .5rem .6rem; border: 1px solid #d1d5db; border-radius: 12px; }
.exo-btn { padding: .55rem .8rem; border-radius: 12px; border: none; color: #fff; background: var(--mpurple); cursor: pointer; }
.exo-btn:hover { background: var(--mpurple-600); }
.exo-check { display: inline-flex; align-items: center; gap: .4rem; margin-right: .8rem; }
.exo-legend { list-style: none; padding: 0; margin: .5rem 0; }
.dot { display:inline-block; width:10px; height:10px; border-radius:999px; margin-right:.4rem; }
.dot.pop { background:#9CA3AF; opacity:.8; }
.dot.jwstObs { background:#4F46E5; }
.dot.jwstPlan { background:#A78BFA; }
.exo-note { color: var(--muted); font-size: .85rem; }
.exo-code { background: #f3f4f6; padding: .6rem; border-radius: 12px; }
@media (max-width: 960px){
  .exo-controls{ grid-template-columns: 1fr; }
  .exo-main{ grid-template-columns: 1fr; }
}
</style>

<script>
const POP_CSV = '/assets/data/pscomppars_recent.csv';
const JWST_LOCAL_CSV = '/assets/data/jwst_trexolists_extended.csv';

const columns = [
  'pl_name','hostname','pl_bmasse','pl_bmassj','pl_rade','pl_radj','pl_orbper','st_age','st_rad','disc_year','tran_flag'
];

const PARAMS = {
  'Best Planet Mass (M_⊕)': d => toNum(d.pl_bmasse),
  'Best Planet Mass (M_J)': d => toNum(d.pl_bmassj),
  'Planet Radius (R_⊕)': d => toNum(d.pl_rade),
  'Planet Radius (R_J)': d => toNum(d.pl_radj),
  'Orbital Period (days)': d => toNum(d.pl_orbper),
  'Stellar Age (Gyr)': d => toNum(d.st_age),
  'Stellar Radius (R_☉)': d => toNum(d.st_rad),
};

const $ = sel => document.querySelector(sel);
const canon = s => (s||'').toString().trim().toLowerCase().replace(/\s+/g,' ');
const toNum = v => (v==null?null:(Number.isFinite(+v)?+v:null));

const state = { planets:[], _all:[], jwstObserved:new Set(), jwstPlanned:new Set() };

function csvFromObjects(arr){
  const headers = Object.keys(arr[0]||{});
  return [headers.join(','), ...arr.map(o=>headers.map(h=>o[h]??'').join(','))].join('\n');
}

function download(filename, text){
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text], {type:'text/csv'}));
  a.download = filename; a.click();
}

async function loadPS(){
  const res = await fetch(POP_CSV);
  if(!res.ok) throw new Error('Population CSV load failed: '+res.status);
  const text = await res.text();
  return d3.csvParse(text);
}

async function loadJWST(){
  try{
    const r = await fetch(JWST_LOCAL_CSV);
    if(!r.ok) throw new Error('local JWST not found');
    const text = await r.text();
    const rows = d3.csvParse(text);
    const namesObserved = new Set();
    const namesPlanned  = new Set();
    const observedStatuses = new Set(['Executed']);
    const plannedStatuses = new Set(['Scheduled','Implementation','Flight Ready','Inactive','On Hold (Inactive)','On Hold','Flight-ready']);
    for(const r of rows){
      const star = (r['Star   name'] || r['Star name'] || r['Star'] || '').trim();
      const letter = (r['Planet   letter'] || r['Planet letter'] || r['Planet'] || '').trim();
      const status = (r['Status'] || '').trim();
      const nm = (star && letter) ? `${star} ${letter}` : (star || letter);
      const key = (nm||'').toLowerCase();
      if(!key) continue;
      if(observedStatuses.has(status)) namesObserved.add(key);
      else if(plannedStatuses.has(status)) namesPlanned.add(key);
    }
    state.jwstObserved = namesObserved;
    state.jwstPlanned  = namesPlanned;
  }catch(err){
    console.warn('JWST local CSV load failed (non-fatal)', err);
  }
}

function buildTraces(){
  const xKey=document.getElementById('xSelect').value, yKey=document.getElementById('ySelect').value;
  const xFn=PARAMS[xKey], yFn=PARAMS[yKey];
  const onlyTransiting = document.getElementById('onlyTransiting').checked;
  const base=[], jwstObs=[], jwstPlan=[];
  for(const p of state.planets){
    if(onlyTransiting && +p.tran_flag!==1) continue;
    const x=xFn(p), y=yFn(p); if(x==null||y==null) continue;
    const key=(p.pl_name||'').toLowerCase();
    const hover = `${p.pl_name}<br>${xKey}: <b>${x}</b><br>${yKey}: <b>${y}</b>`;
    const o={x,y, hovertemplate: hover+'<extra></extra>'};
    if(state.jwstObserved.has(key)) jwstObs.push(o);
    else if(state.jwstPlanned.has(key)) jwstPlan.push(o);
    else base.push(o);
  }
  const traces=[
    {name:'Population', type:'scattergl', mode:'markers', x:base.map(d=>d.x), y:base.map(d=>d.y), hovertemplate:base.map(d=>d.hovertemplate), marker:{size:6, opacity:.45, color:'#9CA3AF'}},
  ];
  if(document.getElementById('highlightJWSTObserved').checked) traces.push({name:'JWST – Observed', type:'scattergl', mode:'markers', x:jwstObs.map(d=>d.x), y:jwstObs.map(d=>d.y), hovertemplate:jwstObs.map(d=>d.hovertemplate), marker:{size:8, opacity:.9, color:'#4F46E5'}});
  if(document.getElementById('highlightJWSTPlanned').checked) traces.push({name:'JWST – Planned', type:'scattergl', mode:'markers', x:jwstPlan.map(d=>d.x), y:jwstPlan.map(d=>d.y), hovertemplate:jwstPlan.map(d=>d.hovertemplate), marker:{size:8, opacity:.9, color:'#A78BFA'}});
  return traces;
}

function layoutForAxes(){
  const xKey=document.getElementById('xSelect').value, yKey=document.getElementById('ySelect').value;
  return {
    margin:{l:60,r:10,t:18,b:50},
    xaxis:{title:xKey, type: document.getElementById('xLog').checked?'log':'linear', zeroline:false},
    yaxis:{title:yKey, type: document.getElementById('yLog').checked?'log':'linear', zeroline:false},
    legend:{orientation:'h'}
  };
}

function refresh(){
  Plotly.react('plot', buildTraces(), layoutForAxes(), {responsive:true, displaylogo:false});
  const shown = Plotly.d3.select('#plot').node()?._fullData?.reduce((a,t)=>a+(t.x?.length||0),0) || 0;
  document.getElementById('counts').textContent = `${shown.toLocaleString()} points shown.`;
}

function populateDropdowns(){
  const xSel = document.getElementById('xSelect');
  const ySel = document.getElementById('ySelect');
  const opts = Object.keys(PARAMS).map(l=>`<option>${l}</option>`).join('');
  xSel.innerHTML = ySel.innerHTML = opts;
  xSel.value = 'Orbital Period (days)';
  ySel.value = 'Best Planet Mass (M_⊕)';
}

function hookUI(){
  ['xSelect','ySelect','xLog','yLog','highlightJWSTObserved','highlightJWSTPlanned','onlyTransiting'].forEach(id=>document.getElementById(id).addEventListener('change', refresh));
  document.getElementById('searchBox').addEventListener('input', e=>{
    const q = (e.target.value||'').toLowerCase();
    if(!q){ state.planets = state._all; refresh(); return; }
    state.planets = state._all.filter(p => (p.pl_name||'').toLowerCase().includes(q) || (p.hostname||'').toLowerCase().includes(q));
    refresh();
  });
  document.getElementById('downloadCSV').addEventListener('click', ()=>{
    const xSel = document.getElementById('xSelect');
    const ySel = document.getElementById('ySelect');
    const xKey = xSel.value, yKey = ySel.value, xFn = PARAMS[xKey], yFn = PARAMS[yKey];
    const out = state.planets.map(p=>({pl_name:p.pl_name, hostname:p.hostname, x_param:xKey, x_value:xFn(p), y_param:yKey, y_value:yFn(p)})).filter(r=>r.x_value!=null&&r.y_value!=null);
    download('exoplanet-explorer.csv', csvFromObjects(out));
  });
}

(async function init(){
  try{
    document.getElementById('endpoints').textContent = `POP_CSV: ${POP_CSV}\nJWST_CSV: ${JWST_LOCAL_CSV}`;
    populateDropdowns(); hookUI();
    const ps = await loadPS();
    state._all = ps; state.planets = ps; refresh();
    document.getElementById('status').textContent = `Loaded local CSVs (rows: ${ps.length.toLocaleString()})`;
    loadJWST().then(()=>refresh()).catch(err=>console.warn('JWST load failed (non-fatal)', err));
  }catch(err){
    console.error(err); document.getElementById('status').textContent = 'Failed to load local CSVs.';
  }
})();
</script>
