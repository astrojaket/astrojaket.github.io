---
layout: default
title: Exoplanets
permalink: /exoplanets
---

<div id="exo-explorer" class="exo-container">
  <div class="exo-controls">
    <div class="exo-card">
      <h2>Axes</h2>
      <div class="exo-grid2">
        <label>X axis
          <select id="xSelect" class="exo-input"></select>
        </label>
        <label>Y axis
          <select id="ySelect" class="exo-input"></select>
        </label>
        <label class="exo-check"><input id="xLog" type="checkbox"/> Log X</label>
        <label class="exo-check"><input id="yLog" type="checkbox"/> Log Y</label>
      </div>
    </div>
    <div class="exo-card">
      <h2>Highlighting</h2>
      <label class="exo-check"><input id="highlightJWSTObserved" type="checkbox" checked/> JWST – Observed</label>
      <label class="exo-check"><input id="highlightJWSTPlanned" type="checkbox" checked/> JWST – Planned</label>
      <label class="exo-check"><input id="onlyTransiting" type="checkbox"/> Only transiting</label>
    </div>
    <div class="exo-card">
      <h2>Search / Data</h2>
      <input id="searchBox" placeholder="Search planet or star…" class="exo-input"/>
      <button id="downloadCSV" class="exo-btn">Download filtered CSV</button>
    </div>
  </div>

  <div class="exo-main">
    <div id="plot" class="exo-plot"></div>
    <aside class="exo-card">
      <h3>Legend</h3>
      <ul class="exo-legend">
        <li><span class="dot pop"></span> Population</li>
        <li><span class="dot jwstobs"></span> JWST – Observed</li>
        <li><span class="dot jwstplan"></span> JWST – Planned</li>
      </ul>
      <div id="counts" class="exo-note">—</div>
      <hr/>
      <div class="exo-note">
        Data: local CSVs from NASA Exoplanet Archive (pscomppars) and TrExoLiSTS (JWST).
      </div>
    </aside>
  </div>

  <details class="exo-card">
    <summary>Show data paths</summary>
    <pre id="endpoints" class="exo-code"></pre>
  </details>

  <div id="status" class="exo-note">Loading CSV files…</div>
</div>

<style>
:root {
  --mpurple: #9370DB;
  --mpurple-600: #7a5fd5;
  --muted: #6b7280;
  --card: #ffffff;
  --bg: #f6f4fb;
}
.exo-container { display: grid; gap: 1rem; }
.exo-controls { display: grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap: 1rem; }
.exo-main { display: grid; grid-template-columns: 1fr 280px; gap: 1rem; }
.exo-card { background: var(--card); border: 1px solid #e5e7eb; border-radius: 16px; padding: 1rem; box-shadow: 0 1px 2px rgba(0,0,0,.05); }
.exo-plot { height: 68vh; background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; }
.exo-input { width: 100%; padding: .5rem .6rem; border: 1px solid #d1d5db; border-radius: 12px; }
.exo-btn { padding: .55rem .8rem; border-radius: 12px; border: none; color: #fff; background: var(--mpurple); cursor: pointer; }
.exo-btn:hover { background: var(--mpurple-600); }
.exo-check { display: inline-flex; align-items: center; gap: .4rem; margin-right: .8rem; }
.exo-legend { list-style: none; padding: 0; margin: .5rem 0; }
.dot { display:inline-block; width:10px; height:10px; border-radius:999px; margin-right:.4rem; }
.dot.pop { background:#9CA3AF; opacity:.8; }
.dot.jwstobs { background:#4F46E5; }
.dot.jwstplan { background:#A78BFA; }
.exo-note { color: var(--muted); font-size: .85rem; }
.exo-code { background: #f3f4f6; padding: .6rem; border-radius: 12px; }
@media (max-width: 960px){ .exo-controls{grid-template-columns:1fr;} .exo-main{grid-template-columns:1fr;} }
</style>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
const PS_CSV_URL = "{ '{' } '/assets/data/pscomppars_recent.csv' | relative_url { '}' }";
const JWST_CSV_URL = "{ '{' } '/assets/data/jwst_trexolists_extended.csv' | relative_url { '}' }";

const PARAMS = {
  'Best Planet Mass (M_⊕)': d => toNum(d.pl_bmasse),
  'Best Planet Mass (M_J)': d => toNum(d.pl_bmassj),
  'Planet Radius (R_⊕)': d => toNum(d.pl_rade),
  'Planet Radius (R_J)': d => toNum(d.pl_radj),
  'Orbital Period (days)': d => toNum(d.pl_orbper),
  'Stellar Age (Gyr)': d => toNum(d.st_age),
  'Stellar Radius (R_☉)': d => toNum(d.st_rad),
};

const $ = sel => document.querySelector(sel);
const canon = s => (s||'').toString().trim().toLowerCase().replace(/\s+/g,' ');
const toNum = v => (v==null?null:(Number.isFinite(+v)?+v:null));
const normName = (star,letter)=>{
  const s=(star||'').toString().trim().replaceAll('\u2212','-');
  const L=(letter||'').toString().trim().replaceAll('\u2212','-');
  return (s&&L)?`${s} ${L}`:s||L||'';
};

const state = { planets:[], _all:[], jwstObserved:new Set(), jwstPlanned:new Set() };

function csvFromObjects(arr){
  const headers = Object.keys(arr[0]||{});
  return [headers.join(','), ...arr.map(o=>headers.map(h=>o[h]??'').join(','))].join('\n');
}
function download(filename, text){
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text], {type:'text/csv'}));
  a.download = filename; a.click();
}

async function loadPopulation(){
  const res = await fetch(PS_CSV_URL);
  const text = await res.text();
  const clean = text.split(/\n/).filter(line => !/^\s*#/.test(line)).join('\n');
  const rows = d3.csvParse(clean);
  return rows.map(r => ({ 
    ...r,
    pl_bmasse: toNum(r.pl_bmasse),
    pl_bmassj: toNum(r.pl_bmassj),
    pl_rade:   toNum(r.pl_rade),
    pl_radj:   toNum(r.pl_radj),
    pl_orbper: toNum(r.pl_orbper),
    st_age:    toNum(r.st_age),
    st_rad:    toNum(r.st_rad),
    tran_flag: toNum(r.tran_flag)
  }));
}

async function loadJWST(){
  const res = await fetch(JWST_CSV_URL);
  const text = await res.text();
  const rows = d3.csvParse(text);
  const observed = new Set();
  const planned  = new Set();
  const plannedStatuses = new Set(['Scheduled','Implementation','Flight Ready','Inactive','On Hold (Inactive)','On Hold']);
  for(const r of rows){
    const name = canon(normName(r['Star   name']||r['Star name']||r['Star'], r['Planet   letter']||r['Planet letter']||r['Planet']));
    const status = (r['Status']||'').trim();
    if(!name) continue;
    if(status === 'Executed') observed.add(name);
    else if(plannedStatuses.has(status)) planned.add(name);
  }
  state.jwstObserved = observed;
  state.jwstPlanned  = planned;
}

function buildTraces(){
  const xKey=$('#xSelect').value, yKey=$('#ySelect').value;
  const xFn=PARAMS[xKey], yFn=PARAMS[yKey];
  const onlyTransiting = $('#onlyTransiting').checked;
  const showObs = $('#highlightJWSTObserved').checked;
  const showPlan = $('#highlightJWSTPlanned').checked;
  const pop=[], obs=[], plan=[];
  for(const p of state.planets){
    if(onlyTransiting && +p.tran_flag!==1) continue;
    const x=xFn(p), y=yFn(p); if(x==null||y==null) continue;
    const nm = canon(p.pl_name);
    const isObs = state.jwstObserved.has(nm);
    const isPlan = state.jwstPlanned.has(nm);
    const hover = `${p.pl_name}<br>${xKey}: <b>${x}</b><br>${yKey}: <b>${y}</b>`;
    const o = {x,y, hovertemplate: hover+'<extra></extra>'};
    if(isObs && showObs) obs.push(o);
    else if(isPlan && showPlan) plan.push(o);
    else pop.push(o);
  }
  const traces=[
    {name:'Population', type:'scattergl', mode:'markers', x:pop.map(d=>d.x), y:pop.map(d=>d.y), hovertemplate:pop.map(d=>d.hovertemplate), marker:{size:6, opacity:.45, color:'#9CA3AF'}},
  ];
  if(showObs) traces.push({name:'JWST – Observed', type:'scattergl', mode:'markers', x:obs.map(d=>d.x), y:obs.map(d=>d.y), hovertemplate:obs.map(d=>d.hovertemplate), marker:{size:8, opacity:.95, color:'#4F46E5'}});
  if(showPlan) traces.push({name:'JWST – Planned', type:'scattergl', mode:'markers', x:plan.map(d=>d.x), y:plan.map(d=>d.y), hovertemplate:plan.map(d=>d.hovertemplate), marker:{size:8, opacity:.95, color:'#A78BFA'}});
  return traces;
}

function layoutForAxes(){
  const xKey=$('#xSelect').value, yKey=$('#ySelect').value;
  return {
    margin:{l:60,r:10,t:18,b:50},
    xaxis:{title:xKey, type: $('#xLog').checked?'log':'linear', zeroline:false},
    yaxis:{title:yKey, type: $('#yLog').checked?'log':'linear', zeroline:false},
    legend:{orientation:'h'}
  };
}

function refresh(){
  Plotly.react('plot', buildTraces(), layoutForAxes(), {responsive:true, displaylogo:false});
  const plot = document.getElementById('plot');
  let shown = 0;
  if(plot && plot.data) shown = plot.data.reduce((a,t)=>a+(t.x?.length||0),0);
  document.getElementById('counts').textContent = `${shown.toLocaleString()} points shown.`;
}

function populateDropdowns(){
  const xSel = document.getElementById('xSelect');
  const ySel = document.getElementById('ySelect');
  const opts = Object.keys(PARAMS).map(l=>`<option>${l}</option>`).join('');
  xSel.innerHTML = ySel.innerHTML = opts;
  xSel.value = 'Orbital Period (days)';
  ySel.value = 'Best Planet Mass (M_⊕)';
}

function hookUI(){
  ['xSelect','ySelect','xLog','yLog','onlyTransiting','highlightJWSTObserved','highlightJWSTPlanned'].forEach(id=>document.getElementById(id).addEventListener('change', refresh));
  document.getElementById('searchBox').addEventListener('input', e=>{
    const q = canon(e.target.value);
    if(!q){ state.planets = state._all; refresh(); return; }
    state.planets = state._all.filter(p => canon(p.pl_name).includes(q) || canon(p.hostname).includes(q)); refresh();
  });
  document.getElementById('downloadCSV').addEventListener('click', ()=>{
    const xSel = document.getElementById('xSelect'); const ySel = document.getElementById('ySelect');
    const xKey=xSel.value, yKey=ySel.value, xFn=PARAMS[xKey], yFn=PARAMS[yKey];
    const out = state.planets.map(p=>({pl_name:p.pl_name, hostname:p.hostname, x_param:xKey, x_value:xFn(p), y_param:yKey, y_value:yFn(p)})).filter(r=>r.x_value!=null&&r.y_value!=null);
    download('exoplanet-explorer.csv', csvFromObjects(out));
  });
}

(async function init(){
  try{
    populateDropdowns(); hookUI();
    $('#endpoints').textContent = `Population CSV: ${PS_CSV_URL}\nJWST CSV: ${JWST_CSV_URL}`;
    document.getElementById('status').textContent = 'Loading CSV files…';
    const ps = await loadPopulation();
    state._all = ps; state.planets = ps; refresh();
    document.getElementById('status').textContent = `Loaded local CSVs (rows: ${ps.length.toLocaleString()})`;
    // Load JWST highlights in background
    loadJWST().then(()=>refresh()).catch(err=>console.error('JWST CSV error', err));
  }catch(err){
    console.error(err);
    document.getElementById('status').textContent = 'Failed to load local CSVs. See console for details.';
  }
})();
</script>
