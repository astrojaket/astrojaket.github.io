---
layout: default
title: Exoplanets
permalink: /exoplanets
---

<div id="exo-explorer" class="exo-container">
  <div class="exo-controls">
    <div class="exo-card">
      <h2>Axes</h2>
      <div class="exo-grid2">
        <label>X axis
          <select id="xSelect" class="exo-input"></select>
        </label>
        <label>Y axis
          <select id="ySelect" class="exo-input"></select>
        </label>
        <label class="exo-check"><input id="xLog" type="checkbox"/> Log X</label>
        <label class="exo-check"><input id="yLog" type="checkbox"/> Log Y</label>
      </div>
    </div>
    <div class="exo-card">
      <h2>Highlighting</h2>
      <label class="exo-check"><input id="highlightJWSTObs" type="checkbox" checked/> JWST — Observed (Executed)</label>
      <label class="exo-check"><input id="highlightJWSTPlan" type="checkbox" checked/> JWST — Planned</label>
      <label class="exo-check"><input id="onlyTransiting" type="checkbox"/> Only transiting</label>
    </div>
    <div class="exo-card">
      <h2>Search / Data</h2>
      <input id="searchBox" placeholder="Search planet or star…" class="exo-input"/>
      <button id="downloadCSV" class="exo-btn">Download filtered CSV</button>
    </div>
  </div>

  <div class="exo-main">
    <div id="plot" class="exo-plot"></div>
    <aside class="exo-card">
      <h3>Legend</h3>
      <ul class="exo-legend">
        <li><span class="dot pop"></span> Population</li>
        <li><span class="dot jwstobs"></span> JWST — Observed</li>
        <li><span class="dot jwstplan"></span> JWST — Planned</li>
      </ul>
      <div id="counts" class="exo-note">—</div>
      <hr/>
      <div class="exo-note">
        Data (local CSVs):<br>
        • /assets/data/pscomppars_recent.csv<br>
        • /assets/data/jwst_trexolists_extended.csv
      </div>
    </aside>
  </div>

  <details class="exo-card">
    <summary>Status</summary>
    <pre id="endpoints" class="exo-code"></pre>
  </details>

  <div id="status" class="exo-note">Loading CSV files…</div>
</div>

<!-- libs -->
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
:root {
  --mpurple: #9370DB;
  --mpurple-600: #7a5fd5;
  --ink: #1f2937;
  --muted: #6b7280;
  --card: #ffffff;
  --bg: #f6f4fb;
}
body { background: var(--bg); }
.exo-container { display: grid; gap: 1rem; }
.exo-controls { display: grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap: 1rem; }
.exo-main { display: grid; grid-template-columns: 1fr 280px; gap: 1rem; }
.exo-card { background: var(--card); border: 1px solid #e5e7eb; border-radius: 16px; padding: 1rem; box-shadow: 0 1px 2px rgba(0,0,0,.05); }
.exo-plot { height: 68vh; background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; }
.exo-input { width: 100%; padding: .5rem .6rem; border: 1px solid #d1d5db; border-radius: 12px; }
.exo-btn { padding: .55rem .8rem; border-radius: 12px; border: none; color: #fff; background: var(--mpurple); cursor: pointer; }
.exo-btn:hover { background: var(--mpurple-600); }
.exo-check { display: inline-flex; align-items: center; gap: .4rem; margin-right: .8rem; }
.exo-legend { list-style: none; padding: 0; margin: .5rem 0; }
.dot { display:inline-block; width:10px; height:10px; border-radius:999px; margin-right:.4rem; }
.dot.pop { background:#9CA3AF; opacity:.8; }
.dot.jwstobs { background: var(--mpurple); }
.dot.jwstplan { background:#10B981; }
.exo-note { color: var(--muted); font-size: .85rem; }
.exo-code { background: #f3f4f6; padding: .6rem; border-radius: 12px; }
@media (max-width: 960px){
  .exo-controls{ grid-template-columns: 1fr; }
  .exo-main{ grid-template-columns: 1fr; }
}
</style>

<script>
const POP_CSV = '/assets/data/pscomppars_recent.csv';
const JWST_CSV = '/assets/data/jwst_trexolists_extended.csv';

const columns = ['pl_name','hostname','pl_bmasse','pl_bmassj','pl_rade','pl_radj','pl_orbper','st_age','st_rad','disc_year','tran_flag'];

const PARAMS = {
  'Best Planet Mass (M_⊕)': d => num(d.pl_bmasse),
  'Best Planet Mass (M_J)': d => num(d.pl_bmassj),
  'Planet Radius (R_⊕)': d => num(d.pl_rade),
  'Planet Radius (R_J)': d => num(d.pl_radj),
  'Orbital Period (days)': d => num(d.pl_orbper),
  'Stellar Age (Gyr)': d => num(d.st_age),
  'Stellar Radius (R_☉)': d => num(d.st_rad),
};

const PLANNED_STATUSES = new Set(['Scheduled','Implementation','Flight Ready','Inactive','On Hold','On Hold (Inactive)']);
const OBS_STATUS = 'Executed';

const state = { planets:[], _all:[], jwstObserved:new Set(), jwstPlanned:new Set() };

const q = sel => document.querySelector(sel);
const canon = s => (s||'').toString().trim().toLowerCase().replace(/\s+/g,' ');
const num = v => (v==null||v===''?null:(isFinite(+v)?+v:null));

function populateDropdowns(){
  const xSel = document.getElementById('xSelect');
  const ySel = document.getElementById('ySelect');
  const opts = Object.keys(PARAMS).map(l=>`<option>${l}</option>`).join('');
  xSel.innerHTML = ySel.innerHTML = opts;
  xSel.value = 'Orbital Period (days)';
  ySel.value = 'Best Planet Mass (M_⊕)';
}

function csvFromObjects(arr){
  const headers = Object.keys(arr[0]||{});
  return [headers.join(','), ...arr.map(o=>headers.map(h=>o[h]??'').join(','))].join('\n');
}

function download(filename, text){
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text], {type:'text/csv'}));
  a.download = filename; a.click();
}

async function loadPopulation(){
  const text = await fetch(POP_CSV).then(r=>{ if(!r.ok) throw new Error('Population CSV '+r.status); return r.text(); });
  // Strip comment lines beginning with # (if any)
  const clean = text.split('\n').filter(line=>!line.trim().startsWith('#')).join('\n');
  const rows = d3.csvParse(clean);
  // Narrow to expected columns if present
  return rows;
}

async function loadJWST(){
  const text = await fetch(JWST_CSV).then(r=>{ if(!r.ok) throw new Error('JWST CSV '+r.status); return r.text(); });
  const rows = d3.csvParse(text);
  const obs = new Set();
  const plan = new Set();
  for(const r of rows){
    const star = (r['Star   name'] || r['Star name'] || r['Star'] || '').trim();
    const letter = (r['Planet   letter'] || r['Planet letter'] || r['Planet'] || '').trim();
    const status = (r['Status'] || '').trim();
    const plname = (star && letter) ? `${star} ${letter}` : (r['Exoplanet name'] || '').trim();
    if(!plname) continue;
    const key = canon(plname);
    if(status === OBS_STATUS) obs.add(key);
    else if(PLANNED_STATUSES.has(status)) plan.add(key);
  }
  state.jwstObserved = obs;
  state.jwstPlanned = plan;
}

function buildTraces(){
  const xKey = document.getElementById('xSelect').value;
  const yKey = document.getElementById('ySelect').value;
  const xFn = PARAMS[xKey], yFn = PARAMS[yKey];
  const onlyTransiting = document.getElementById('onlyTransiting').checked;
  const showObs = document.getElementById('highlightJWSTObs').checked;
  const showPlan = document.getElementById('highlightJWSTPlan').checked;

  const base=[], obs=[], plan=[];
  for(const p of state.planets){
    if(onlyTransiting && +p.tran_flag !== 1 && p.tran_flag !== '1') continue;
    const x = xFn(p), y = yFn(p);
    if(x==null || y==null) continue;
    const nm = canon(p.pl_name);
    const isObs = state.jwstObserved.has(nm);
    const isPlan = state.jwstPlanned.has(nm);
    const hover = `${p.pl_name}<br>${xKey}: <b>${x}</b><br>${yKey}: <b>${y}</b>`;
    const pt = {x,y, hovertemplate: hover+'<extra></extra>'};
    if(isObs) obs.push(pt);
    else if(isPlan) plan.push(pt);
    else base.push(pt);
  }

  const traces=[
    {name:'Population', type:'scattergl', mode:'markers', x:base.map(d=>d.x), y:base.map(d=>d.y), hovertemplate:base.map(d=>d.hovertemplate), marker:{size:6, opacity:.45, color:'#9CA3AF'}},
  ];
  if(showObs) traces.push({name:'JWST — Observed', type:'scattergl', mode:'markers', x:obs.map(d=>d.x), y:obs.map(d=>d.y), hovertemplate:obs.map(d=>d.hovertemplate), marker:{size:8, opacity:.9, color:getComputedStyle(document.documentElement).getPropertyValue('--mpurple').trim()||'#9370DB'}});
  if(showPlan) traces.push({name:'JWST — Planned', type:'scattergl', mode:'markers', x:plan.map(d=>d.x), y:plan.map(d=>d.y), hovertemplate:plan.map(d=>d.hovertemplate), marker:{size:8, opacity:.9, color:'#10B981'}});
  return traces;
}

function layoutForAxes(){
  const xKey = document.getElementById('xSelect').value;
  const yKey = document.getElementById('ySelect').value;
  return {
    margin:{l:60,r:10,t:18,b:50},
    xaxis:{title:xKey, type: document.getElementById('xLog').checked?'log':'linear', zeroline:false},
    yaxis:{title:yKey, type: document.getElementById('yLog').checked?'log':'linear', zeroline:false},
    legend:{orientation:'h'}
  };
}

function refresh(){
  const traces = buildTraces();
  Plotly.react('plot', traces, layoutForAxes(), {responsive:true, displaylogo:false});
  // Compute shown points directly from traces (don't use Plotly.d3)
  const shown = traces.reduce((acc, t) => acc + ((t.x && t.x.length) || 0), 0);
  document.getElementById('counts').textContent = `${shown.toLocaleString()} points shown.`;
}

function hookUI(){
  ['xSelect','ySelect','xLog','yLog','highlightJWSTObs','highlightJWSTPlan','onlyTransiting'].forEach(id=>document.getElementById(id).addEventListener('change', refresh));
  document.getElementById('searchBox').addEventListener('input', e=>{
    const q = canon(e.target.value);
    if(!q){ state.planets = state._all; refresh(); return; }
    state.planets = state._all.filter(p => canon(p.pl_name).includes(q) || canon(p.hostname).includes(q));
    refresh();
  });
  document.getElementById('downloadCSV').addEventListener('click', ()=>{
    const xKey = document.getElementById('xSelect').value;
    const yKey = document.getElementById('ySelect').value;
    const xFn = PARAMS[xKey], yFn = PARAMS[yKey];
    const out = state.planets.map(p=>({pl_name:p.pl_name, hostname:p.hostname, x_param:xKey, x_value:xFn(p), y_param:yKey, y_value:yFn(p)})).filter(r=>r.x_value!=null&&r.y_value!=null);
    download('exoplanet-explorer.csv', csvFromObjects(out));
  });
}

(async function init(){
  try{
    populateDropdowns(); hookUI();
    document.getElementById('endpoints').textContent = `Population CSV: ${POP_CSV}\nJWST CSV: ${JWST_CSV}`;
    const pop = await loadPopulation();
    state._all = pop; state.planets = pop;
    document.getElementById('status').textContent = `Loaded local CSVs (rows: ${pop.length})`;
    refresh();
    // Load JWST after plot appears; then refresh to color points
    loadJWST().then(()=>refresh()).catch(err=>console.warn('JWST load failed (non-fatal)', err));
  }catch(err){
    console.error(err);
    document.getElementById('status').textContent = 'Failed to load local CSVs.';
  }
})();
</script>
