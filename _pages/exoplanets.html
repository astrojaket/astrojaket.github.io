---
layout: default
title: Exoplanets
permalink: /exoplanets
---

<!-- Exoplanet Explorer (local CSVs) -->
<div id="exo-explorer" class="exo-container">
  <div class="exo-topbar">
    <div class="exo-controls">
      <div class="exo-card">
        <h2>Axes</h2>
        <div class="exo-grid2">
          <label>X axis
            <select id="xSelect" class="exo-input"></select>
          </label>
          <label>Y axis
            <select id="ySelect" class="exo-input"></select>
          </label>
          <label class="exo-check"><input id="xLog" type="checkbox"/> Log X</label>
          <label class="exo-check"><input id="yLog" type="checkbox"/> Log Y</label>
          <label class="exo-check"><input id="colorTemp" type="checkbox"/> Color by Teq (K)</label>
          <label class="exo-check"><input id="onlyTransiting" type="checkbox"/> Only transiting</label>
        </div>
      </div>

      <div class="exo-card">
        <h2>Filters (set limits then press Update)</h2>
        <div class="exo-grid4 exo-filters">
          <div><div class="exo-filter-label">Best Mass (M⊕)</div>
            <input id="f-min-pl_bmasse" class="exo-input" type="number" step="any" placeholder="min" />
            <input id="f-max-pl_bmasse" class="exo-input" type="number" step="any" placeholder="max" />
          </div>
          <div><div class="exo-filter-label">Best Mass (MJ)</div>
            <input id="f-min-pl_bmassj" class="exo-input" type="number" step="any" placeholder="min" />
            <input id="f-max-pl_bmassj" class="exo-input" type="number" step="any" placeholder="max" />
          </div>
          <div><div class="exo-filter-label">Radius (R⊕)</div>
            <input id="f-min-pl_rade" class="exo-input" type="number" step="any" placeholder="min" />
            <input id="f-max-pl_rade" class="exo-input" type="number" step="any" placeholder="max" />
          </div>
          <div><div class="exo-filter-label">Radius (RJ)</div>
            <input id="f-min-pl_radj" class="exo-input" type="number" step="any" placeholder="min" />
            <input id="f-max-pl_radj" class="exo-input" type="number" step="any" placeholder="max" />
          </div>
          <div><div class="exo-filter-label">Period (days)</div>
            <input id="f-min-pl_orbper" class="exo-input" type="number" step="any" placeholder="min" />
            <input id="f-max-pl_orbper" class="exo-input" type="number" step="any" placeholder="max" />
          </div>
          <div><div class="exo-filter-label">Stellar Age (Gyr)</div>
            <input id="f-min-st_age" class="exo-input" type="number" step="any" placeholder="min" />
            <input id="f-max-st_age" class="exo-input" type="number" step="any" placeholder="max" />
          </div>
          <div><div class="exo-filter-label">Stellar Radius (R☉)</div>
            <input id="f-min-st_rad" class="exo-input" type="number" step="any" placeholder="min" />
            <input id="f-max-st_rad" class="exo-input" type="number" step="any" placeholder="max" />
          </div>
          <div><div class="exo-filter-label">Equilibrium T (K)</div>
            <input id="f-min-pl_eqt" class="exo-input" type="number" step="any" placeholder="min" />
            <input id="f-max-pl_eqt" class="exo-input" type="number" step="any" placeholder="max" />
          </div>
        </div>
        <div class="exo-row gap">
          <button id="applyFilters" class="exo-btn">Update</button>
          <button id="clearFilters" class="exo-btn ghost">Clear</button>
        </div>
      </div>

      <div class="exo-card">
        <h2>Highlights</h2>
        <label class="exo-check"><input id="highlightJWSTObs" type="checkbox" checked/> JWST – Observed</label>
        <label class="exo-check"><input id="highlightJWSTPlan" type="checkbox" checked/> JWST – Planned</label>
        <div class="exo-note">Observed = Executed. Planned = Scheduled / Implementation / Flight Ready / Inactive / On Hold.</div>
      </div>
    </div>

    <aside class="exo-card exo-presets">
      <h2>Presets</h2>
      <div class="exo-chiprow">
        <span class="exo-chip sep">Kempton+18 bins</span>
        <button class="exo-chip" data-preset="k18-rocky">&lt;1.5 R⊕</button>
        <button class="exo-chip" data-preset="k18-small">1.5–2.75 R⊕</button>
        <button class="exo-chip" data-preset="k18-subn">2.75–4.0 R⊕</button>
        <button class="exo-chip" data-preset="k18-giant">&gt;4 R⊕</button>
      </div>
      <div class="exo-chiprow">
        <span class="exo-chip sep">Popular</span>
        <button class="exo-chip" data-preset="hotjup">Hot Jupiters</button>
        <button class="exo-chip" data-preset="subnep">Sub‑Neptunes</button>
      </div>
    </aside>
  </div>

  <div class="exo-main">
    <div id="plot" class="exo-plot"></div>
    <aside class="exo-card">
      <h3>Legend</h3>
      <ul class="exo-legend">
        <li><span class="dot pop"></span> Population</li>
        <li><span class="dot jwstobs"></span> JWST – Observed</li>
        <li><span class="dot jwstplan"></span> JWST – Planned</li>
      </ul>
      <div id="counts" class="exo-note">—</div>
      <hr/>
      <div class="exo-note">
        Data files: <code>/assets/data/pscomppars_recent.csv</code>, <code>/assets/data/jwst_trexolists_extended.csv</code>
      </div>
      <div id="status" class="exo-note">Loading local CSVs…</div>
    </aside>
  </div>

  <details class="exo-card">
    <summary>Show inputs</summary>
    <pre id="endpoints" class="exo-code"></pre>
  </details>
</div>

<!-- libs -->
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
:root {
  --mpurple: #9370DB;
  --mpurple-600: #7a5fd5;
  --muted: #6b7280;
  --ink: #111827;
  --bg: #f6f4fb;
}
body { background: var(--bg); }
.exo-container { display: grid; gap: 1rem; }
.exo-topbar { display:grid; grid-template-columns: 1fr 300px; gap: 1rem; }
.exo-controls { display: grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap: 1rem; }
.exo-main { display: grid; grid-template-columns: 1fr 300px; gap: 1rem; }
.exo-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; padding: 1rem; box-shadow: 0 1px 2px rgba(0,0,0,.05); }
.exo-plot { height: 70vh; border: 1px solid #e5e7eb; border-radius: 16px; }
.exo-input { width: 100%; padding: .45rem .6rem; border: 1px solid #d1d5db; border-radius: 10px; }
.exo-btn { padding: .55rem .8rem; border-radius: 10px; border: none; color: #fff; background: var(--mpurple); cursor: pointer; }
.exo-btn.ghost { background: transparent; color: var(--mpurple); border: 1px solid var(--mpurple-600); }
.exo-btn:hover { background: var(--mpurple-600); }
.exo-check { display:inline-flex; align-items:center; gap:.4rem; margin-right:.6rem; }
.exo-legend { list-style:none; padding:0; margin:.5rem 0; }
.dot { display:inline-block; width:10px; height:10px; border-radius:999px; margin-right:.4rem; }
.dot.pop { background:#9CA3AF; opacity:.8; }
.dot.jwstobs { background:var(--mpurple); }
.dot.jwstplan { background:#06b6d4; }
.exo-note { color: var(--muted); font-size: .85rem; }
.exo-code { background:#f3f4f6; padding:.6rem; border-radius:12px; }
.exo-grid2 { display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:.6rem; }
.exo-grid4 { display:grid; grid-template-columns: repeat(4,minmax(0,1fr)); gap:.6rem; }
.exo-row.gap { display:flex; gap:.6rem; margin-top:.5rem; }
.exo-presets .exo-chiprow { display:flex; flex-wrap:wrap; align-items:center; gap:.4rem; margin-bottom:.4rem; }
.exo-chip { background:#f3f0ff; border:1px solid #e1d7ff; color:#4b3a8f; padding:.25rem .5rem; border-radius:999px; font-size:.85rem; cursor:pointer; }
.exo-chip.sep { background:transparent; border:0; color:#6b7280; cursor:default; font-weight:600; }
@media (max-width: 1100px){
  .exo-controls{ grid-template-columns: 1fr; }
  .exo-topbar{ grid-template-columns: 1fr; }
  .exo-main{ grid-template-columns: 1fr; }
}
</style>

<script>
// ---------------------------
// Config & columns
// ---------------------------
const POP_CSV = '/assets/data/pscomppars_recent.csv';
const JWST_CSV = '/assets/data/jwst_trexolists_extended.csv';

const columns = [
  'pl_name','hostname','pl_bmasse','pl_bmassj','pl_rade','pl_radj',
  'pl_orbper','st_age','st_rad','pl_eqt','tran_flag'
];

const PARAMS = {
  'Best Planet Mass (M_⊕)': d => num(d.pl_bmasse),
  'Best Planet Mass (M_J)': d => num(d.pl_bmassj),
  'Planet Radius (R_⊕)': d => num(d.pl_rade),
  'Planet Radius (R_J)': d => num(d.pl_radj),
  'Orbital Period (days)': d => num(d.pl_orbper),
  'Stellar Age (Gyr)': d => num(d.st_age),
  'Stellar Radius (R_☉)': d => num(d.st_rad),
  'Equilibrium Temperature (K)': d => num(d.pl_eqt),
};

const PRESETS = {
  // Kempton+2018 TSM radius bins
  'k18-rocky': { pl_rade: [null, 1.5] },
  'k18-small': { pl_rade: [1.5, 2.75] },
  'k18-subn':  { pl_rade: [2.75, 4.0] },
  'k18-giant': { pl_rade: [4.0, null] },
  // Popular shorthand
  'hotjup': { pl_rade: [8, null], pl_eqt: [1000, null] },
  'subnep': { pl_rade: [2, 4] },
};

// ---------------------------
// Utilities
// ---------------------------
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const num = v => (v==null || v==='' ? null : (isFinite(+v)? +v : null));
const canon = s => (s||'').toString().trim().toLowerCase().replace(/\s+/g,' ');

function csvParseLoose(text){
  // ignore comment lines starting with # (some Archive dumps include headers/comments)
  const cleaned = text.split(/\n/).filter(l => !/^\s*#/.test(l)).join('\n');
  return d3.csvParse(cleaned);
}

function setFilter(id, val){
  const el = document.getElementById(id);
  el.value = (val==null? '' : val);
}

// ---------------------------
// State
// ---------------------------
const state = {
  all: [],              // full population (CSV rows as objects)
  rows: [],             // filtered rows to plot
  jwstObserved: new Set(), // pl_name canonical
  jwstPlanned: new Set(),
  filters: {}           // key -> [min,max] numeric
};

// ---------------------------
// Loaders
// ---------------------------
async function loadCSV(url){
  const res = await fetch(url, {mode:'cors'});
  if(!res.ok) throw new Error('Failed to fetch '+url+' '+res.status);
  const txt = await res.text();
  return csvParseLoose(txt);
}

async function loadPopulation(){
  const rows = await loadCSV(POP_CSV);
  // Coerce types for the columns we care about
  for(const r of rows){
    for(const k of ['pl_bmasse','pl_bmassj','pl_rade','pl_radj','pl_orbper','st_age','st_rad','pl_eqt']){
      if (r[k] !== undefined) r[k] = num(r[k]);
    }
    if (r['tran_flag'] !== undefined) r['tran_flag'] = num(r['tran_flag']);
  }
  return rows;
}

async function loadJWST(){
  const rows = await loadCSV(JWST_CSV);
  const obs = new Set(), plan = new Set();
  const PLANNED = new Set(['Scheduled','Implementation','Flight Ready','Inactive','On Hold','On Hold (Inactive)']);
  for(const r of rows){
    // JWST CSV columns: expect 'Star   name','Planet   letter','Status' etc.
    const nm = canon(((r['Star   name']||r['Star name']||r['Star']||'').trim() + ' ' + (r['Planet   letter']||r['Planet letter']||r['Planet']||'').trim()).trim());
    const status = (r['Status']||'').trim();
    if(!nm) continue;
    if(status === 'Executed') obs.add(nm);
    else if(PLANNED.has(status)) plan.add(nm);
  }
  return {obs, plan};
}

// ---------------------------
function populateDropdowns(){
  const xSel = document.getElementById('xSelect');
  const ySel = document.getElementById('ySelect');
  const opts = Object.keys(PARAMS).map(l=>`<option>${l}</option>`).join('');
  xSel.innerHTML = ySel.innerHTML = opts;
  xSel.value = 'Orbital Period (days)';
  ySel.value = 'Planet Radius (R_⊕)';
}

function applyFiltersAndRefresh(){
  // Build current filter object from inputs
  const keys = ['pl_bmasse','pl_bmassj','pl_rade','pl_radj','pl_orbper','st_age','st_rad','pl_eqt'];
  const f = {};
  for(const k of keys){
    const minv = num(document.getElementById('f-min-'+k).value);
    const maxv = num(document.getElementById('f-max-'+k).value);
    if(minv!=null || maxv!=null) f[k] = [minv, maxv];
  }
  state.filters = f;
  filterRows();
  refresh();
}

function clearFilters(){
  Object.keys(state.filters).forEach(k=> delete state.filters[k]);
  $$('.exo-filters input').forEach(i=> i.value='');
  state.rows = state.all.slice();
  refresh();
}

function filterRows(){
  const onlyTransiting = document.getElementById('onlyTransiting').checked;
  const f = state.filters;
  state.rows = state.all.filter(r => {
    if (onlyTransiting && r.tran_flag !== 1) return false;
    for(const [k, range] of Object.entries(f)){
      const v = r[k];
      if(v==null) return false;
      const [mn, mx] = range;
      if(mn!=null && v<mn) return false;
      if(mx!=null && v>mx) return false;
    }
    return true;
  });
}

function buildTraces(){
  const xKey = document.getElementById('xSelect').value;
  const yKey = document.getElementById('ySelect').value;
  const xFn = PARAMS[xKey], yFn = PARAMS[yKey];
  const colorByTeq = document.getElementById('colorTemp').checked;
  const showObs = document.getElementById('highlightJWSTObs').checked;
  const showPlan = document.getElementById('highlightJWSTPlan').checked;

  const pop = [], obs = [], plan = [];
  for(const p of state.rows){
    const x=xFn(p), y=yFn(p);
    if(x==null || y==null) continue;
    const nm = canon(p.pl_name);
    const isObs = state.jwstObserved.has(nm);
    const isPlan = state.jwstPlanned.has(nm);
    const t = {x, y, teq: num(p.pl_eqt)};
    if(isObs) obs.push(t);
    else if(isPlan) plan.push(t);
    else pop.push(t);
  }

  const traces = [];
  if(colorByTeq){
    // Color population by Teq; JWST as outlined rings on top
    traces.push({
      name: 'Population (Teq)',
      type: 'scattergl', mode:'markers',
      x: pop.map(d=>d.x), y: pop.map(d=>d.y),
      marker: {
        size: 6, opacity: .7,
        color: pop.map(d => d.teq ?? NaN),
        colorbar: {title:'Teq (K)'},
        colorscale: 'Viridis',
        showscale: true
      },
      hovertemplate: '%{x}, %{y}<extra></extra>'
    });
    if(showPlan) traces.push({
      name: 'JWST – Planned',
      type:'scattergl', mode:'markers',
      x: plan.map(d=>d.x), y: plan.map(d=>d.y),
      marker:{ size:10, opacity:.95, color:'#06b6d4', line:{width:1.5, color:'#034d57'} },
      hovertemplate: '%{x}, %{y}<extra></extra>'
    });
    if(showObs) traces.push({
      name: 'JWST – Observed',
      type:'scattergl', mode:'markers',
      x: obs.map(d=>d.x), y: obs.map(d=>d.y),
      marker:{ size:10, opacity:.95, color:'#9370DB', line:{width:1.5, color:'#4b3a8f'} },
      hovertemplate: '%{x}, %{y}<extra></extra>'
    });
  }else{
    // Classic palette
    traces.push({
      name: 'Population', type:'scattergl', mode:'markers',
      x: pop.map(d=>d.x), y: pop.map(d=>d.y),
      marker:{ size:6, opacity:.45, color:'#9CA3AF' },
      hovertemplate: '%{x}, %{y}<extra></extra>'
    });
    if(showPlan) traces.push({ name:'JWST – Planned', type:'scattergl', mode:'markers',
      x: plan.map(d=>d.x), y: plan.map(d=>d.y),
      marker:{ size:8, opacity:.9, color:'#06b6d4' }, hovertemplate:'%{x}, %{y}<extra></extra>' });
    if(showObs) traces.push({ name:'JWST – Observed', type:'scattergl', mode:'markers',
      x: obs.map(d=>d.x), y: obs.map(d=>d.y),
      marker:{ size:8, opacity:.9, color:'#9370DB' }, hovertemplate:'%{x}, %{y}<extra></extra>' });
  }
  return traces;
}

function layoutForAxes(){
  const xKey = document.getElementById('xSelect').value;
  const yKey = document.getElementById('ySelect').value;
  return {
    margin:{l:60,r:10,t:18,b:50},
    xaxis:{title:xKey, type: document.getElementById('xLog').checked ? 'log' : 'linear', zeroline:false},
    yaxis:{title:yKey, type: document.getElementById('yLog').checked ? 'log' : 'linear', zeroline:false},
    legend:{orientation:'h'}
  };
}

function refresh(){
  const traces = buildTraces();
  Plotly.react('plot', traces, layoutForAxes(), {responsive:true, displaylogo:false});
  const shown = traces.reduce((acc,t)=> acc + ((t.x && t.x.length)||0), 0);
  document.getElementById('counts').textContent = `${shown.toLocaleString()} points shown (filters applied to ${state.rows.length.toLocaleString()} rows).`;
}

function hookUI(){
  // Axes/log toggles refresh instantly
  ['xSelect','ySelect','xLog','yLog','colorTemp','onlyTransiting','highlightJWSTObs','highlightJWSTPlan']
    .forEach(id => document.getElementById(id).addEventListener('change', refresh));
  // Filters only apply when clicking Update
  document.getElementById('applyFilters').addEventListener('click', applyFiltersAndRefresh);
  document.getElementById('clearFilters').addEventListener('click', () => clearFilters());
  // Presets
  document.querySelectorAll('.exo-chip[data-preset]').forEach(btn => {
    btn.addEventListener('click', () => {
      const p = btn.getAttribute('data-preset');
      const def = PRESETS[p]||{};
      // Clear then apply
      clearFilters();
      for(const [k,[mn,mx]] of Object.entries(def)){
        setFilter('f-min-'+k, mn);
        setFilter('f-max-'+k, mx);
      }
      // Do not auto-apply; require Update to respect user's request
    });
  });
}

function summarizeInputs(){
  const s = [];
  s.push('Population CSV: '+POP_CSV);
  s.push('JWST CSV: '+JWST_CSV);
  s.push('Filters: '+JSON.stringify(state.filters));
  document.getElementById('endpoints').textContent = s.join('\n');
}

// ---------------------------
// Boot
// ---------------------------
(async function init(){
  try{
    populateDropdowns(); hookUI();
    const [popRows, jwst] = await Promise.all([loadPopulation(), loadJWST()]);
    state.all = popRows.slice();
    state.rows = popRows.slice();
    state.jwstObserved = jwst.obs;
    state.jwstPlanned = jwst.plan;
    document.getElementById('status').textContent = `Loaded local CSVs (rows: ${state.all.length.toLocaleString()})`;
    summarizeInputs();
    refresh();
  }catch(err){
    console.error(err);
    document.getElementById('status').textContent = 'Failed to load local CSVs.';
  }
})();
</script>
