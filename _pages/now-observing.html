---
layout: page
title: Now Observing
permalink: /now-observing/
---
<link rel="preconnect" href="https://mast.stsci.edu">
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<style>
  :root { --mp: MediumPurple; --bg:#120c22; --card:#1b1330; --border:#3b2d66; --ink:#eee; --muted:#c9c9d9; }
  .section { margin: 1.2rem 0; }
  .row { display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-start; }
  .card { flex: 1 1 420px; background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 14px; color: var(--ink); }
  h1, h2, h3 { color: var(--mp); margin: .2rem 0 .6rem; }
  .pill { display:inline-block; padding:.2rem .5rem; border-radius:999px; font-size:.8rem; border:1px solid var(--border); background:#2a2048; color:#d9cdfd; }
  .loading { opacity:.8; font-style: italic; }
  table { width:100%; border-collapse: collapse; }
  th, td { padding: .45rem .5rem; border-bottom: 1px solid var(--border); }
  th { text-align:left; color:#d9cdfd; }
  .small { font-size: .9rem; color: var(--muted); }
  .stamp { color:#bbb; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
  .btn { background:#3b2d66; color:#fff; border:1px solid #5a45a8; padding:.35rem .6rem; border-radius:8px; cursor:pointer; }
  .btn:disabled { opacity:.5; cursor:not-allowed; }
  .legend { font-size:.95rem; line-height:1.35; }
  .err { color:#ffb4b4; }
</style>

<h1>Now Observing — JWST & HST</h1>
<p class="small">Live snapshot of observations overlapping the current time (±3 hours), via the MAST Mashup API.</p>

<div class="row">
  <div class="card" style="max-width: 860px;">
    <h2>Live Timeline</h2>
    <div id="timeline" style="height: 320px;"></div>
    <div id="summary" class="small"></div>
  </div>
  <div class="card" style="max-width: 520px;">
    <h2>Controls</h2>
    <div class="small">Window: <span id="winText"></span></div>
    <div style="margin:.4rem 0;">
      <button id="refreshBtn" class="btn">Refresh now</button>
    </div>
    <div class="legend">
      <div><span class="pill">JWST</span> &nbsp; <span class="small">MAST (CAOM)</span></div>
      <div><span class="pill">HST</span> &nbsp; <span class="small">MAST (CAOM)</span></div>
      <div class="small" style="margin-top:.5rem;">Each bar spans an observation’s <code>t_min → t_max</code> in UTC within the ±3h window.</div>
    </div>
  </div>
</div>

<div class="row">
  <div class="card">
    <h2>Currently Observing — JWST</h2>
    <div id="jwstStatus" class="loading">Loading…</div>
    <table id="jwstTbl" style="display:none;">
      <thead><tr>
        <th>Start (UTC)</th><th>End</th><th>Target</th><th>Instrument</th><th>Program</th>
      </tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="card">
    <h2>Currently Observing — HST</h2>
    <div id="hstStatus" class="loading">Loading…</div>
    <table id="hstTbl" style="display:none;">
      <thead><tr>
        <th>Start (UTC)</th><th>End</th><th>Target</th><th>Instrument</th><th>Program</th>
      </tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div class="section small">
  <h3>Notes</h3>
  <ul>
    <li>Data: <code>Mast.Caom.Filtered</code> with filters on <code>obs_collection</code> and MJD bounds <code>t_min</code>, <code>t_max</code>.</li>
    <li>“Currently” ≈ observations where <code>t_min ≤ now ≤ t_max</code> (archive block timing).</li>
  </ul>
  <div class="small">Last updated: <span id="stamp" class="stamp"></span></div>
</div>

<script>
(function(){
  const API = 'https://mast.stsci.edu/api/v0/invoke'; // CORS-enabled
  const HRS = 3; // +/- window hours

  function toMJD(d){ return (d.getTime()/86400000) + 40587.0; }
  function toISO(d){ return d.toISOString().replace('.000','').replace('Z','Z'); }
  function fromMJD(mjd){ return new Date((mjd - 40587.0) * 86400000); }

  function setWindowText(center){
    const a = new Date(center.getTime() - HRS*3600*1000);
    const b = new Date(center.getTime() + HRS*3600*1000);
    document.getElementById('winText').textContent = toISO(a) + ' … ' + toISO(b);
    document.getElementById('stamp').textContent = toISO(new Date());
  }

  async function mastFiltered(collection, mjdNow, plusHours){
    // anything with t_min <= now and t_max >= now (allow a small look-ahead to catch program edges)
    const max1 = mjdNow;
    const min2 = mjdNow;
    const max2 = mjdNow + (plusHours/24.0);

    const request = {
      "service":"Mast.Caom.Filtered",
      "format":"json",
      "params":{
        "columns":"obs_collection,obsid,obs_id,obs_title,proposal_id,proposal_pi,instrument_name,target_name,t_min,t_max",
        "filters":[
          {"paramName":"obs_collection","values":[collection]},
          {"paramName":"t_min","values":[{"max":max1}]},
          {"paramName":"t_max","values":[{"min":min2,"max":max2}]}
        ]
      },
      "pagesize": 2000,
      "page": 1
    };

    const body = "request=" + encodeURIComponent(JSON.stringify(request));
    const resp = await fetch(API, {
      method: "POST",
      headers: {"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8", "Accept":"application/json"},
      body
    });
    if(!resp.ok) throw new Error(collection + " fetch failed " + resp.status);
    const data = await resp.json();
    if(data.status !== "COMPLETE") throw new Error(collection + " status " + data.status);
    return data.data || [];
  }

  function fillTable(tblId, statusId, rows){
    const tbl = document.getElementById(tblId);
    const status = document.getElementById(statusId);
    const tb = tbl.querySelector('tbody');
    tb.innerHTML = '';
    rows.sort((a,b)=>a.t_min - b.t_min).forEach(r=>{
      const tr = document.createElement('tr');
      const t0 = fromMJD(r.t_min), t1 = fromMJD(r.t_max);
      tr.innerHTML = '<td>'+toISO(t0)+'</td><td>'+toISO(t1)+'</td><td>'+(r.target_name||'')+'</td><td>'+(r.instrument_name||'')+'</td><td>'+(r.proposal_id||'')+'</td>';
      tb.appendChild(tr);
    });
    status.style.display='none';
    tbl.style.display = rows.length ? 'table' : 'none';
    if(!rows.length){ status.textContent = 'No observations in this window.'; status.style.display='block'; }
  }

  function drawTimeline(jwst, hst, center){
    function toBar(arr,label,color){
      return (arr||[]).map(function(r){
        return { x: [fromMJD(r.t_min), fromMJD(r.t_max)], y: [label,label], mode: 'lines',
          line: {width: 10, color: color}, hoverinfo: 'text',
          text: (r.target_name||'') + ' — ' + (r.instrument_name||'') + ' — ' + (r.proposal_id||'') };
      });
    }
    var traces = [].concat(toBar(jwst,'JWST','#9370DB')).concat(toBar(hst,'HST','#10B981'));
    var a = new Date(center.getTime() - HRS*3600*1000);
    var b = new Date(center.getTime() + HRS*3600*1000);
    Plotly.newPlot('timeline', traces, { margin:{l:60,r:10,t:10,b:40}, xaxis:{title:'UTC', type:'date', range:[a,b]}, yaxis:{type:'category'}, showlegend:false },
      {displaylogo:false, responsive:true});
    document.getElementById('summary').textContent = (jwst.length + " JWST · " + hst.length + " HST observations overlapping now");
  }

  async function loadAll(){
    const now = new Date();
    setWindowText(now);
    const mjdNow = toMJD(now);
    try{
      const both = await Promise.all([ mastFiltered('JWST', mjdNow, 3), mastFiltered('HST', mjdNow, 3) ]);
      const jwst = both[0] || [], hst = both[1] || [];
      fillTable('jwstTbl','jwstStatus', jwst);
      fillTable('hstTbl','hstStatus', hst);
      drawTimeline(jwst, hst, now);
    }catch(err){
      console.error(err);
      document.getElementById('jwstStatus').textContent = 'Error: ' + err.message;
      document.getElementById('hstStatus').textContent = 'Error: ' + err.message;
    }
  }

  document.getElementById('refreshBtn').addEventListener('click', loadAll);
  loadAll();
})();
</script>
