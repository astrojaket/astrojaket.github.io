---
layout: page
title: Now Observing (Last 24 Hours)
permalink: /now-observing/
---
<link rel="preconnect" href="https://mast.stsci.edu">
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<style>
  :root{ --brand: MediumPurple; --ink:#111827; --muted:#4b5563; --panel:#fff; --border:#e5e7eb; }
  h1, h2, h3 { color: var(--brand); }
  .wrap { display:flex; flex-wrap:wrap; gap:1rem; align-items:flex-start; }
  .card { flex:1 1 420px; background: var(--panel); border:1px solid var(--border); border-radius:14px; padding:14px 16px; color:var(--ink); box-shadow:0 1px 2px rgba(0,0,0,.04); }
  .small { color: var(--muted); font-size:.92rem; }
  .btn { background: var(--brand); color:#fff; border:none; padding:.45rem .7rem; border-radius:8px; cursor:pointer; }
  table { width:100%; border-collapse: collapse; }
  th, td { padding:.5rem .55rem; border-bottom:1px solid var(--border); }
  th { text-align:left; color: var(--ink); }
  .pill { display:inline-block; padding:.2rem .5rem; border:1px solid var(--border); border-radius:999px; background:#fafafa; }
  .legend { line-height:1.35; }
  .loading { opacity:.8; font-style: italic; }
  .err { color:#b91c1c; }
</style>

<h1>Now Observing — JWST & HST (Last 24 Hours)</h1>
<p class="small">This page uses a local cache (<code>assets/data/mast_24h.json</code>) refreshed hourly from MAST to avoid browser CORS issues.</p>

<div class="wrap">
  <div class="card" style="max-width:880px">
    <h2>Timeline (UTC)</h2>
    <div id="timeline" style="height: 340px;"></div>
    <div id="summary" class="small"></div>
  </div>
  <div class="card" style="max-width:520px">
    <h2>Controls</h2>
    <div class="small">Window: <span id="winText"></span></div>
    <div style="margin:.5rem 0 0.2rem">
      <button id="refreshBtn" class="btn">Reload file</button>
    </div>
    <div class="legend small">
      <div><span class="pill">JWST</span> &nbsp; MAST (CAOM) → cached hourly</div>
      <div><span class="pill">HST</span> &nbsp; MAST (CAOM) → cached hourly</div>
      <div style="margin-top:.4rem">Bars span each observation’s <code>t_min → t_max</code> within the 24h window.</div>
    </div>
  </div>
</div>

<div class="wrap" style="margin-top:1rem">
  <div class="card">
    <h2>Observations — JWST</h2>
    <div id="jwstStatus" class="loading">Loading local JSON…</div>
    <table id="jwstTbl" style="display:none">
      <thead><tr><th>Start (UTC)</th><th>End</th><th>Target</th><th>Instrument</th><th>Program</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="card">
    <h2>Observations — HST</h2>
    <div id="hstStatus" class="loading">Loading local JSON…</div>
    <table id="hstTbl" style="display:none">
      <thead><tr><th>Start (UTC)</th><th>End</th><th>Target</th><th>Instrument</th><th>Program</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div class="small" style="margin-top:1rem">
  <h3>Notes</h3>
  <ul>
    <li>Window = <code>now − 24h</code> → <code>now</code>.</li>
    <li>Filter: include rows where <code>t_min ≤ window_end</code> and <code>t_max ≥ window_start</code>.</li>
  </ul>
  <div>Last updated from MAST: <span id="stamp">—</span></div>
</div>

<script>
(function(){
  const HOURS = 24;
  function toISO(d){ return d.toISOString().replace('.000','').replace('Z','Z'); }
  function fromMJD(mjd){ return new Date((mjd - 40587.0) * 86400000); }

  function setWindowText(start, end){
    const el = document.getElementById('winText');
    el.textContent = toISO(start) + ' … ' + toISO(end);
  }

  function fillTable(tblId, statusId, rows){
    const tbl = document.getElementById(tblId);
    const status = document.getElementById(statusId);
    const tb = tbl.querySelector('tbody');
    tb.innerHTML = '';
    rows.sort(function(a,b){ return a.t_min - b.t_min; }).forEach(function(r){
      const tr = document.createElement('tr');
      const t0 = fromMJD(r.t_min), t1 = fromMJD(r.t_max);
      tr.innerHTML = '<td>'+toISO(t0)+'</td><td>'+toISO(t1)+'</td><td>'+ (r.target_name||'') +'</td><td>'+ (r.instrument_name||'') +'</td><td>'+ (r.proposal_id||'') +'</td>';
      tb.appendChild(tr);
    });
    status.style.display='none';
    tbl.style.display = rows.length ? 'table' : 'none';
    if(!rows.length){ status.textContent = 'No observations in the last 24 hours.'; status.style.display='block'; }
  }

  function drawTimeline(jwst, hst, start, end){
    function toBar(arr,label,color){
      return (arr||[]).map(function(r){
        return { x: [fromMJD(r.t_min), fromMJD(r.t_max)], y: [label,label], mode: 'lines',
          line: {width: 10, color: color}, hoverinfo: 'text',
          text: (r.target_name||'') + ' — ' + (r.instrument_name||'') + ' — ' + (r.proposal_id||'') };
      });
    }
    var traces = [].concat(toBar(jwst,'JWST','#7c3aed')).concat(toBar(hst,'HST','#059669'));
    Plotly.newPlot('timeline', traces, {
      margin:{l:60,r:10,t:10,b:40},
      xaxis:{title:'UTC', type:'date', range:[start, end]},
      yaxis:{type:'category'},
      showlegend:false
    }, {displaylogo:false, responsive:true});
    document.getElementById('summary').textContent =
      (jwst.length + ' JWST · ' + hst.length + ' HST observations in the last 24 hours');
  }

  async function loadLocal(){
    const end = new Date();
    const start = new Date(end.getTime() - HOURS*3600*1000);
    setWindowText(start, end);
    try{
      const r = await fetch('/assets/data/mast_24h.json', {cache:'no-store'});
      if(!r.ok) throw new Error('Local JSON not found');
      const payload = await r.json();
      const jwst = payload.jwst || [];
      const hst  = payload.hst  || [];
      fillTable('jwstTbl','jwstStatus', jwst);
      fillTable('hstTbl','hstStatus', hst);
      drawTimeline(jwst, hst, start, end);
      if(payload.generated_utc){
        document.getElementById('stamp').textContent = payload.generated_utc + ' (UTC)';
      }
    }catch(err){
      document.getElementById('jwstStatus').textContent = 'Could not load local JSON. Run the GitHub Action or generate it once manually.';
      document.getElementById('hstStatus').textContent  = 'Could not load local JSON. Run the GitHub Action or generate it once manually.';
      console.error(err);
    }
  }

  document.getElementById('refreshBtn').addEventListener('click', loadLocal);
  loadLocal();
})();
</script>