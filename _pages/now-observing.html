---
layout: page
title: Now Observing
permalink: /now-observing/
---
<link rel="preconnect" href="https://mast.stsci.edu">
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<style>
  .section { margin: 1.2rem 0; }
  .row { display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-start; }
  .card { flex: 1 1 380px; background: #1b1330; border: 1px solid #3b2d66; border-radius: 16px; padding: 14px; color: #eee; }
  h1, h2, h3 { color: MediumPurple; margin: .2rem 0 .6rem; }
  .pill { display:inline-block; padding:.2rem .5rem; border-radius:999px; font-size:.8rem; border:1px solid #4b3b80; background:#2a2048; color:#d9cdfd; }
  .loading { opacity:.75; font-style: italic; }
  table { width:100%; border-collapse: collapse; }
  th, td { padding: .45rem .5rem; border-bottom: 1px solid #3b2d66; }
  th { text-align:left; color:#d9cdfd; }
  .small { font-size: .9rem; color:#c9c9d9; }
  .stamp { color:#bbb; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
  .btn { background:#3b2d66; color:#fff; border:1px solid #5a45a8; padding:.35rem .6rem; border-radius:8px; cursor:pointer; }
  .btn:disabled { opacity:.5; cursor:not-allowed; }
  .legend { font-size:.95rem; line-height:1.35; }
</style>
<h1>“Now Observing” — JWST · HST · Ground</h1>
<p class="small">Shows observations overlapping the current time (±3 hours) using the MAST API for JWST & HST. Ground-based feeds can be added below.</p>
<div class="row">
  <div class="card" style="max-width: 860px;">
    <h2>Live Timeline</h2>
    <div id="timeline" style="height: 320px;"></div>
    <div id="summary" class="small"></div>
  </div>
  <div class="card" style="max-width: 520px;">
    <h2>Controls</h2>
    <div class="small">Window: <span id="winText"></span></div>
    <div style="margin:.4rem 0;">
      <button id="refreshBtn" class="btn">Refresh now</button>
    </div>
    <div class="legend">
      <div><span class="pill">JWST</span> &nbsp; <span class="small">From MAST Observations (CAOM)</span></div>
      <div><span class="pill">HST</span> &nbsp; <span class="small">From MAST Observations (CAOM)</span></div>
      <div class="small" style="margin-top:.5rem;">Axis shows UTC time within the ±3h window; each bar spans an observation’s <code>t_min → t_max</code>.</div>
    </div>
  </div>
</div>
<div class="row">
  <div class="card">
    <h2>Currently Observing — JWST</h2>
    <div id="jwstStatus" class="loading">Loading…</div>
    <table id="jwstTbl" style="display:none;">
      <thead><tr>
        <th>Start (UTC)</th><th>End</th><th>Target</th><th>Instrument</th><th>Program</th>
      </tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="card">
    <h2>Currently Observing — HST</h2>
    <div id="hstStatus" class="loading">Loading…</div>
    <table id="hstTbl" style="display:none;">
      <thead><tr>
        <th>Start (UTC)</th><th>End</th><th>Target</th><th>Instrument</th><th>Program</th>
      </tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<div class="section card">
  <h2>Ground-based (beta)</h2>
  <p class="small">Many observatories publish schedules in HTML/PDF without open CORS APIs. For a static site, add a JSON feed (example below) to <code>/assets/data/ground_now.json</code> and we’ll render it here.</p>
  <pre class="small" style="white-space: pre-wrap; border:1px solid #3b2d66; border-radius:8px; padding:.6rem; background:#120c22;">
[
  {"facility":"ESO VLT UT1","start_utc":"2025-08-16T19:00:00Z","end_utc":"2025-08-16T23:59:00Z","target":"NGC 1068","instrument":"MUSE","program":"0104.B-XXXX"},
  {"facility":"Gemini North","start_utc":"2025-08-16T06:15:00Z","end_utc":"2025-08-16T12:30:00Z","target":"WASP-43","instrument":"GMOS-N","program":"GN-2025B-Q-101"}
]</pre>
  <div id="groundStatus" class="loading">Looking for <code>/assets/data/ground_now.json</code>…</div>
  <table id="groundTbl" style="display:none;">
    <thead><tr><th>Facility</th><th>Start</th><th>End</th><th>Target</th><th>Instrument</th><th>Program</th></tr></thead>
    <tbody></tbody>
  </table>
</div>
<div class="section small">
  <h3>Notes & Sources</h3>
  <ul>
    <li>Data via the <strong>MAST Mashup API</strong> (<code>Mast.Caom.Filtered</code>) with filters on <code>obs_collection</code> and MJD time bounds <code>t_min</code>/<code>t_max</code>. See docs: MAST API Tutorial and CAOM fields.</li>
    <li>“Currently observing” is approximated as observations where <code>t_min ≤ now ≤ t_max</code>. This reflects the observation block timing at the archive level, not sub-exposure status.</li>
    <li>Ground-based schedules vary; if you can provide an open JSON or ICS, we will render it automatically. Otherwise a small GitHub Action can scrape and write <code>ground_now.json</code>.</li>
  </ul>
  <div class="small">Last updated: <span id="stamp" class="stamp"></span></div>
</div>
<script>
(function(){
  const API = 'https://mast.stsci.edu/api/v0/invoke';
  const HRS = 3;
  function toMJD(d){ return (d.getTime()/86400000) + 40587.0; }
  function toISO(d){ return d.toISOString().replace('.000','').replace('Z','Z'); }
  function fromMJD(mjd){ return new Date((mjd - 40587.0) * 86400000); }
  function setWindowText(center){
    const a = new Date(center.getTime() - HRS*3600*1000);
    const b = new Date(center.getTime() + HRS*3600*1000);
    document.getElementById('winText').textContent = toISO(a) + ' … ' + toISO(b);
    document.getElementById('stamp').textContent = toISO(new Date());
  }
  async function mastFiltered(collection, mjdNow, plusHours){
    const max1 = mjdNow;
    const min2 = mjdNow;
    const max2 = mjdNow + (plusHours/24.0);
    const request = {
      "service":"Mast.Caom.Filtered",
      "format":"json",
      "params":{
        "columns":"obs_collection,obsid,obs_id,obs_title,proposal_id,proposal_pi,instrument_name,target_name,t_min,t_max",
        "filters":[
          {"paramName":"obs_collection","values":[collection]},
          {"paramName":"t_min","values":[{"max":max1}]},
          {"paramName":"t_max","values":[{"min":min2,"max":max2}]}
        ]
      },
      "pagesize": 2000,
      "page": 1
    };
    const body = "request=" + encodeURIComponent(JSON.stringify(request));
    const resp = await fetch(API, { method: "POST",
      headers: {"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8", "Accept":"application/json"}, body });
    if(!resp.ok) throw new Error(collection + " fetch failed " + resp.status);
    const data = await resp.json();
    if(data.status !== "COMPLETE") throw new Error(collection + " status " + data.status);
    return data.data || [];
  }
  function fillTable(tblId, statusId, rows){
    const tbl = document.getElementById(tblId);
    const status = document.getElementById(statusId);
    const tb = tbl.querySelector('tbody');
    tb.innerHTML = '';
    rows.sort((a,b)=>a.t_min - b.t_min).forEach(r=>{
      const tr = document.createElement('tr');
      const t0 = fromMJD(r.t_min), t1 = fromMJD(r.t_max);
      tr.innerHTML = `<td>${toISO(t0)}</td><td>${toISO(t1)}</td><td>${r.target_name||''}</td><td>${r.instrument_name||''}</td><td>${r.proposal_id||''}</td>`;
      tb.appendChild(tr);
    });
    status.style.display='none';
    tbl.style.display = rows.length ? 'table' : 'none';
    if(!rows.length){ status.textContent = 'No observations in this window.'; status.style.display='block'; }
  }
  function drawTimeline(jwst, hst, center){
    function toBar(arr,label,color){
      return (arr||[]).map(function(r){
        return { x: [fromMJD(r.t_min), fromMJD(r.t_max)], y: [label,label], mode: 'lines',
          line: {width: 10, color: color}, hoverinfo: 'text',
          text: (r.target_name||'') + ' — ' + (r.instrument_name||'') + ' — ' + (r.proposal_id||'') };
      });
    }
    var traces = [].concat(toBar(jwst,'JWST','#9370DB')).concat(toBar(hst,'HST','#10B981'));
    var a = new Date(center.getTime() - HRS*3600*1000);
    var b = new Date(center.getTime() + HRS*3600*1000);
    Plotly.newPlot('timeline', traces, { margin:{l:60,r:10,t:10,b:40}, xaxis:{title:'UTC', type:'date', range:[a,b]}, yaxis:{type:'category'}, showlegend:false },
      {displaylogo:false, responsive:true});
    document.getElementById('summary').textContent = (jwst.length + " JWST · " + hst.length + " HST observations overlapping now");
  }
  async function loadAll(){
    const now = new Date();
    setWindowText(now);
    const mjdNow = toMJD(now);
    try{
      const both = await Promise.all([ mastFiltered('JWST', mjdNow, 3), mastFiltered('HST', mjdNow, 3) ]);
      const jwst = both[0] || [], hst = both[1] || [];
      fillTable('jwstTbl','jwstStatus', jwst);
      fillTable('hstTbl','hstStatus', hst);
      drawTimeline(jwst, hst, now);
    }catch(err){
      console.error(err);
      document.getElementById('jwstStatus').textContent = 'Error: ' + err.message;
      document.getElementById('hstStatus').textContent = 'Error: ' + err.message;
    }
    try{
      const r = await fetch('/assets/data/ground_now.json', {cache:'no-store'});
      if(r.ok){
        const rows = await r.json();
        const tb = document.querySelector('#groundTbl tbody');
        tb.innerHTML='';
        (rows||[]).forEach(function(g){
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${g.facility||''}</td><td>${g.start_utc||''}</td><td>${g.end_utc||''}</td><td>${g.target||''}</td><td>${g.instrument||''}</td><td>${g.program||''}</td>`;
          tb.appendChild(tr);
        });
        document.getElementById('groundStatus').style.display='none';
        document.getElementById('groundTbl').style.display = (rows && rows.length) ? 'table' : 'none';
        if(!rows || !rows.length){
          document.getElementById('groundStatus').textContent = 'No ground JSON found or list is empty.';
          document.getElementById('groundStatus').style.display='block';
        }
      } else {
        document.getElementById('groundStatus').textContent = 'No ground JSON found (optional).';
      }
    }catch(e){
      document.getElementById('groundStatus').textContent = 'Ground feed error: ' + e.message;
    }
  }
  document.getElementById('refreshBtn').addEventListener('click', loadAll);
  loadAll();
})();
</script>
